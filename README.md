# ğŸ“¡ Enhanced Template-based LangChain System AI

**LG U+ ìš”ê¸ˆì œ/êµ¬ë… ì„œë¹„ìŠ¤ ì¶”ì²œ AI ëŒ€í™” ì‹œìŠ¤í…œ**

OpenAI GPT-4o-mini + LangChain + FastAPI + Redis ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ **ê°•í™”ëœ AI ì¸í…íŠ¸ ê°ì§€**ì™€ **Nonsense ì…ë ¥ ì²˜ë¦¬**ë¥¼ íƒ‘ì¬í•œ Template-based ëŒ€í™” AIì…ë‹ˆë‹¤.

4ë‹¨ê³„ ë©€í‹°í„´ í”Œë¡œìš°ë¥¼ í†µí•´ ì‚¬ìš©ì ì„±í–¥ì„ íŒŒì•…í•˜ê³ , ê°œì¸ ë§ì¶¤í˜• ì„œë¹„ìŠ¤ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì¶”ì²œí•˜ë©°, ì´ìƒí•œ ì…ë ¥ì´ë‚˜ ì˜¤í”„í† í”½ ì§ˆë¬¸ì—ë„ ì ì ˆí•˜ê²Œ ëŒ€ì‘í•©ë‹ˆë‹¤.

[MoonuZ](https://github.com/Ureca-Middle-Project-Team4) í”„ë¡œì íŠ¸ì˜ AI ëŒ€í™” ì—”ì§„ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ì´ˆê°„ë‹¨ ì‹¤í–‰ ë°©ë²•

### macOS/Linux ì‚¬ìš©ì
```cmd
git clone https://github.com/Ureca-Middle-Project-Team4/4EVER0-AI
cd 4EVER0-AI
chmod +x setup.sh run.sh
./setup.sh
./run.sh
```

### **ê°œë°œì ìˆ˜ë™ ì„¤ì¹˜**
```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡ 
git clone https://github.com/Ureca-Middle-Project-Team4/4EVER0-AI
cd 4EVER0-AI

# 2. ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r chatbot-server/requirements.txt
# Windows: pip install -r chatbot-server/requirements-windows.txt

# 4. .env ì„¤ì • 
# chatbot-server/.env ìƒì„± ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •

# 5. Redis ì‹œì‘ (Linux/macOSë§Œ)
redis-server --daemonize yes

# 6. ì„œë²„ ì‹¤í–‰
cd chatbot-server
python run.py
# ë˜ëŠ”
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## ì£¼ìš” ê¸°ëŠ¥

> **Template-based Conversational AI**ë¡œ RAG ëŒ€ë¹„ ë¹ ë¥¸ ì‘ë‹µì†ë„ì™€ ì¼ê´€ëœ í’ˆì§ˆì„ ì œê³µí•˜ë©´ì„œë„ **ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”**ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### **í…œí”Œë¦¿ ê¸°ë°˜ ì•„í‚¤í…ì²˜ + AI ì¸í…íŠ¸**
- **Smart Intent Detection**: GPT-4o-mini + í´ë°± ë¡œì§ìœ¼ë¡œ 99% ì •í™•ë„
- **Nonsense Input Handling**: "ã…ã„´ã…‡ã„¹", "asdf", "1234" ë“± ì˜ë¯¸ì—†ëŠ” ì…ë ¥ ê°ì§€
- **Multiturn Answer Recognition**: ë©€í‹°í„´ ëŒ€í™” ì¤‘ ë‹µë³€ì„ ì •í™•íˆ ì¸ì‹
- **Greeting Priority**: ì¸ì‚¬ë§ì„ ìµœìš°ì„ ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ìì—°ìŠ¤ëŸ¬ìš´ ì‹œì‘
- **Context-Aware Processing**: ëŒ€í™” ìƒí™©ì— ë§ëŠ” ì ì‘í˜• ì‘ë‹µ

### **ë©€í‹°í„´ ëŒ€í™” ê´€ë¦¬**
- **Unified Session Keys**: ì¼ê´€ëœ ì„¸ì…˜ í‚¤ë¡œ ì•ˆì •ì„± í–¥ìƒ
- **Flow State Preservation**: ëŒ€í™” ì¤‘ë‹¨ ì‹œì—ë„ ì •í™•í•œ ìƒíƒœ ë³µì›
- **Smart Flow Transition**: í”Œë¡œìš° ì™„ë£Œ í›„ ìƒˆë¡œìš´ ëŒ€í™” ìë™ ì „í™˜
- **Redis Session Migration**: ê¸°ì¡´ ì„¸ì…˜ê³¼ ìƒˆ ì„¸ì…˜ ê°„ ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜
- **Error Recovery**: ì˜¤ë¥˜ ë°œìƒ ì‹œ graceful ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜

### **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìµœì í™”**
- **Differentiated Latency**: ì§ˆë¬¸ 0.05ì´ˆ, AI ì‘ë‹µ 0.01ì´ˆ
- **Natural User Experience**: ì‹¤ì œ íƒ€ì´í•‘ íŒ¨í„´ ëª¨ë°©
- **Async Processing**: FastAPI ê¸°ë°˜ ë™ì‹œ ë‹¤ì¤‘ ì‚¬ìš©ì ì§€ì›
- **Memory Efficient**: Redis TTL 30ë¶„ìœ¼ë¡œ íš¨ìœ¨ì  ë©”ëª¨ë¦¬ ê´€ë¦¬

### **í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì‘ë‹µ**
- **Dual Character System**: ì „ë¬¸ ìƒë‹´ì›ê³¼ ì¹œê·¼í•œ ë¬´ë„ˆ ì¤‘ ì„ íƒ
- **2025 Trendy Language**: ìµœì‹  ìœ í–‰ì–´ ë°˜ì˜í•œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”
- **Tone Adaptation**: ì‚¬ìš©ì ì„ í˜¸ì— ë”°ë¥¸ ì‹¤ì‹œê°„ í†¤ ë³€ê²½
- **Emotional Intelligence**: ìƒí™©ì— ë§ëŠ” ê°ì •ì  ì‘ë‹µ

### **ê°•í™”ëœ ëŒ€í™” ê°€ë“œë ˆì¼**
- **Off-topic Classification**: ì¬ë¯¸ìˆëŠ”/ì§€ë£¨í•œ/ë¶ˆë¶„ëª…í•œ ì˜¤í”„í† í”½ ì„¸ë¶„í™”
- **Technical Issue Detection**: ê¸°ìˆ ì  ë¬¸ì œ ìë™ ê°ì§€ ë° ëŒ€ì‘
- **Input Validation**: ì‚¬ìš©ì ì…ë ¥ì˜ ìœ íš¨ì„± ì‹¤ì‹œê°„ ê²€ì¦
- **Graceful Degradation**: ì‹œìŠ¤í…œ ì˜¤ë¥˜ ì‹œì—ë„ ìì—°ìŠ¤ëŸ¬ìš´ ì‘ë‹µ ìœ ì§€

## ğŸ› ï¸ Tech Stack

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Language** | Python 3.9+ |
| **Framework** | FastAPI |
| **AI Engine** | OpenAI GPT-4o-mini |
| **AI Pipeline** | **LangChain Template-based Chain** |
| **Session Management** | Redis (TTL 1800ì´ˆ) |
| **ORM / DB** | SQLAlchemy (ORM), MySQL |
| **í™˜ê²½ ê´€ë¦¬** | .env, python-dotenv |
| **ë°±ì—”ë“œ ì—°ë™** | Spring Boot (RestTemplate) |
| **Intent Classification** | GPT-4o-mini + Fallback Logic |
| **Conversation Guard** | Multi-layered Response System |

**ğŸ“„ API ë¬¸ì„œ:**
- [Swagger Docs](http://localhost:8000/docs)
- [ReDoc Docs](http://localhost:8000/redoc)

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
4EVER0-AI/
â”œâ”€â”€ chatbot-server/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/          # API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py         # ì¼ë°˜ ì±„íŒ… ë° ì¶”ì²œ
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_like.py    # ì¢‹ì•„ìš” ê¸°ë°˜ ì¶”ì²œ
â”‚   â”‚   â”‚   â”œâ”€â”€ ubti.py         # UBTI ì„±í–¥ ë¶„ì„
â”‚   â”‚   â”‚   â”œâ”€â”€ usage.py        # ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ì¶”ì²œ
â”‚   â”‚   â”‚   â””â”€â”€ user.py         # ì‚¬ìš©ì ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ chains/       # LangChain ëŒ€í™” ì²´ì¸
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_chain.py   # ë©€í‹°í„´ ëŒ€í™” ì²´ì¸
â”‚   â”‚   â”‚   â””â”€â”€ usage_chain.py  # ì‚¬ìš©ëŸ‰ ë¶„ì„ ì²´ì¸
â”‚   â”‚   â”œâ”€â”€ db/           # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py     # DB ì—°ê²° ì„¤ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py       # SQLAlchemy ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ *_db.py         # ê° í…Œì´ë¸”ë³„ ì¿¼ë¦¬
â”‚   â”‚   â”œâ”€â”€ prompts/      # AI í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚   â”‚   â”‚   â”œâ”€â”€ get_prompt_template.py  # í†µí•© í”„ë¡¬í”„íŠ¸ ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ plan_prompt.py          # ìš”ê¸ˆì œ ì¶”ì²œ í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ subscription_prompt.py  # êµ¬ë… ì¶”ì²œ í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ like_prompt.py          # ì¢‹ì•„ìš” ê¸°ë°˜ í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ubti_prompt.py          # UBTI ë¶„ì„ í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ usage_prompt.py         # ì‚¬ìš©ëŸ‰ ë¶„ì„ í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”œâ”€â”€ schemas/      # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py         # ì±„íŒ… ìš”ì²­/ì‘ë‹µ ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ubti.py         # UBTI ê´€ë ¨ ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ usage.py        # ì‚¬ìš©ëŸ‰ ê´€ë ¨ ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ user.py         # ì‚¬ìš©ì ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ services/     # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”‚   â”œâ”€â”€ handle_chat.py      # ì±„íŒ… ì²˜ë¦¬ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ handle_chat_likes.py # ì¢‹ì•„ìš” ê¸°ë°˜ ì²˜ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ handle_ubti.py      # UBTI ì²˜ë¦¬ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ handle_usage.py     # ì‚¬ìš©ëŸ‰ ì²˜ë¦¬ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ utils/        # ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ intent.py               # ì¸í…íŠ¸ ê°ì§€ í†µí•©
â”‚   â”‚   â”‚   â”œâ”€â”€ intent_classifier.py   # AI ì¸í…íŠ¸ ë¶„ë¥˜ê¸°
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation_guard.py  # ëŒ€í™” ê°€ë“œë ˆì¼
â”‚   â”‚   â”‚   â”œâ”€â”€ redis_client.py        # Redis ì„¸ì…˜ ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ langchain_client.py    # LangChain ì„¤ì •
â”‚   â”‚   â”‚   â””â”€â”€ price_parser.py        # ê°€ê²© íŒŒì‹± ìœ í‹¸
â”‚   â”‚   â”œâ”€â”€ config.py     # í™˜ê²½ ì„¤ì •
â”‚   â”‚   â””â”€â”€ main.py       # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ requirements.txt  # íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”‚   â”œâ”€â”€ requirements-windows.txt  # Windowsìš© íŒ¨í‚¤ì§€
â”‚   â””â”€â”€ run.py           # ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ setup.sh / setup.bat  # ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ run.sh / run.bat      # ìë™ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ README.md
```

## Smart Plan Recommendation System

> ì‚¬ìš©ì ì •ë³´ë¥¼ ì¢…í•© ë¶„ì„í•˜ì—¬ ìµœì ì˜ ìš”ê¸ˆì œë¥¼ ì¶”ì²œí•˜ëŠ” AI ì‹œìŠ¤í…œ

```mermaid
flowchart TD
    A[ì‚¬ìš©ì ì…ë ¥ ë¶„ì„] --> B[ì˜ˆì‚° ë²”ìœ„ ì¶”ì¶œ]
    A --> C[ë°ì´í„° ìš”êµ¬ì‚¬í•­ ë¶„ì„]
    A --> D[í†µí™” íŒ¨í„´ ë¶„ì„]
    
    B --> E[í•œêµ­ì–´ ìˆ«ì ë³€í™˜]
    E --> F[íŒ¨í„´ ë§¤ì¹­]
    F --> G{ì˜ˆì‚° ìœ í˜•}
    G -->|ì´ìƒ/ë„˜/ì´ˆê³¼| H[ìµœì†Œê°’-ìµœëŒ€ê°’ ì„¤ì •]
    G -->|ì´í•˜/ë¯¸ë§Œ/ê¹Œì§€| I[0-ìµœëŒ€ê°’ ì„¤ì •]
    G -->|ì •ë„/ëŒ€/ì¯¤| J[Â±5000ì› ë²”ìœ„]
    
    C --> K[ë°ì´í„° ìš”êµ¬ì‚¬í•­ ë¶„ë¥˜]
    K --> L{ë°ì´í„° íƒ€ì…}
    L -->|ë§ì´| M[ë¬´ì œí•œ/ëŒ€ìš©ëŸ‰ ì„ í˜¸]
    L -->|ì ê²Œ| N[ê¸°ë³¸/ì†Œìš©ëŸ‰ ì„ í˜¸]
    L -->|ë³´í†µ| O[ì¤‘ê°„ ìš©ëŸ‰ ì„ í˜¸]
    
    D --> P[í†µí™” íŒ¨í„´ ë¶„ì„]
    
    H --> Q[ìŠ¤ë§ˆíŠ¸ ì ìˆ˜ ê³„ì‚°]
    I --> Q
    J --> Q
    M --> Q
    N --> Q
    O --> Q
    P --> Q
    
    Q --> R[ìš”ê¸ˆì œë³„ ì ìˆ˜ ì‚°ì¶œ]
    R --> S{ì ìˆ˜ ê¸°ì¤€}
    S -->|ì˜ˆì‚° ì í•©ì„±| T[60ì  - ê°€ì¥ ì¤‘ìš”]
    S -->|ë°ì´í„° ìš”êµ¬ì‚¬í•­| U[30ì  - ë‘ë²ˆì§¸ ì¤‘ìš”]
    S -->|í†µí™” íŒ¨í„´| V[10ì  - ë³´ì¡° ìš”ì†Œ]
    S -->|ì¸ê¸°ë„ ë³´ì •| W[ë„ˆê²Ÿ>ë¼ì´íŠ¸>ê¸°íƒ€]
    
    T --> X[ìµœì¢… ì ìˆ˜ í•©ì‚°]
    U --> X
    V --> X
    W --> X
    
    X --> Y[ì ìˆ˜ ê¸°ì¤€ ì •ë ¬]
    Y --> Z[ìƒìœ„ 2ê°œ ì„ íƒ]
    Z --> AA[ë§ì¶¤ ì¶”ì²œ ì™„ë£Œ]
```

### **ì˜ˆì‚° ë¶„ì„ ì•Œê³ ë¦¬ì¦˜**

| ì…ë ¥ ì˜ˆì‹œ | ì¸ì‹ ê²°ê³¼ | ë²”ìœ„ ì„¤ì • |
|-----------|-----------|-----------|
| "5ë§Œì› ì´í•˜" | ì´í•˜ íŒ¨í„´ | 0ì› ~ 50,000ì› |
| "7ë§Œì› ì´ìƒ" | ì´ìƒ íŒ¨í„´ | 70,000ì› ~ 200,000ì› |
| "3ë§Œì›ëŒ€" | ëŒ€ íŒ¨í„´ | 25,000ì› ~ 35,000ì› |
| "ì˜¤ë§Œì› ì •ë„" | ì •ë„ íŒ¨í„´ | 45,000ì› ~ 55,000ì› |
| "3-5ë§Œì›" | ë²”ìœ„ íŒ¨í„´ | 30,000ì› ~ 50,000ì› |

### **ì ìˆ˜ ê³„ì‚° ì‹œìŠ¤í…œ**

```mermaid
graph LR
    A[ìš”ê¸ˆì œ] --> B[ì˜ˆì‚° ì í•©ì„±<br/>60ì ]
    A --> C[ë°ì´í„° ë§¤ì¹­<br/>30ì ]
    A --> D[í†µí™” íŒ¨í„´<br/>10ì ]
    A --> E[ë¸Œëœë“œ ë³´ì •<br/>+Î±ì ]
    
    B --> F[ìµœì¢… ì ìˆ˜]
    C --> F
    D --> F
    E --> F
    
    F --> G{ìˆœìœ„ ê²°ì •}
    G --> H[1ìˆœìœ„ ì¶”ì²œ]
    G --> I[2ìˆœìœ„ ì¶”ì²œ]
```

## Conversational System Architecture

```mermaid
graph TD
    A[ì‚¬ìš©ì ë©”ì‹œì§€] --> B{ì…ë ¥ ê²€ì¦}
    B -->|Valid| C[AI ì¸í…íŠ¸ ë¶„ë¥˜ê¸°]
    B -->|Nonsense| H[Nonsense í•¸ë“¤ëŸ¬]
    
    C --> D[í´ë°± ë¡œì§ 1ì°¨ ê²€ì¦]
    D -->|í™•ì‹¤í•œ ì¼€ì´ìŠ¤| E[ì¦‰ì‹œ ë¶„ë¥˜]
    D -->|ì• ë§¤í•œ ì¼€ì´ìŠ¤| F[GPT-4o-mini AI ë¶„ë¥˜]
    
    E --> G{ì¸í…íŠ¸ ë¼ìš°íŒ…}
    F --> G
    H --> G
    
    G -->|greeting| I[ì¸ì‚¬ ì‘ë‹µ]
    G -->|telecom_plan| J[ìš”ê¸ˆì œ ë©€í‹°í„´]
    G -->|subscription| K[êµ¬ë… ë©€í‹°í„´]
    G -->|multiturn_answer| L[ë©€í‹°í„´ ë‹µë³€ ì²˜ë¦¬]
    G -->|off_topic_*| M[ì˜¤í”„í† í”½ ê°€ë“œë ˆì¼]
    G -->|current_usage| N[ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ì¶”ì²œ]
    G -->|likes_based_recommendation| O[ì¢‹ì•„ìš” ê¸°ë°˜ ì¶”ì²œ]
    G -->|ubti| P[UBTI API ì•ˆë‚´]
    G -->|tech_issue| Q[ê¸°ìˆ  ë¬¸ì œ ì²˜ë¦¬]
    
    subgraph "Unified Multiturn Flow"
        J --> R[4ë‹¨ê³„ ì§ˆë¬¸ í”Œë¡œìš°]
        K --> R
        L --> R
        R --> S[Redis ì„¸ì…˜ í†µí•© ê´€ë¦¬]
        S --> T[ìµœì¢… ì¶”ì²œ ìƒì„±]
        T --> U[í”Œë¡œìš° ì™„ë£Œ ë° ì´ˆê¸°í™”]
    end
    
    subgraph "Smart Usage Recommendation"
        N --> V[ì‚¬ìš©ëŸ‰ íŒ¨í„´ ë¶„ì„]
        V --> W[ì‚¬ìš©ì íƒ€ì… ë¶„ë¥˜]
        W --> X[ë¹„ìš© íš¨ê³¼ ê³„ì‚°]
        X --> Y[ë§ì¶¤ ìš”ê¸ˆì œ í•„í„°ë§]
        Y --> Z[ê°œì¸í™”ëœ ì„¤ëª… ìƒì„±]
        Z --> AA[ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ]
    end
    
    subgraph "Likes-based Recommendation Engine"
        O --> AB[ì¢‹ì•„ìš” ë°ì´í„° ìˆ˜ì§‘]
        AB --> AC[ì„ í˜¸ë„ íŒ¨í„´ ë¶„ì„]
        AC --> AD[ì¹´í…Œê³ ë¦¬ë³„ í´ëŸ¬ìŠ¤í„°ë§]
        AD --> AE[ìœ ì‚¬ë„ ê¸°ë°˜ í•„í„°ë§]
        AE --> AF[ë§ì¶¤ êµ¬ë… íŒ¨í‚¤ì§€]
        AF --> AG[ì·¨í–¥ ë§ì¶¤ ì„¤ëª…]
        AG --> AH[ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°]
    end
    
    subgraph "Enhanced Guard System"
        M --> AI[ì¬ë¯¸ìˆëŠ” ì˜¤í”„í† í”½]
        M --> AJ[ì§€ë£¨í•œ ì˜¤í”„í† í”½]
        M --> AK[ë¶ˆë¶„ëª…í•œ ì˜¤í”„í† í”½]
        H --> AL[ì˜ë¯¸ì—†ëŠ” ì…ë ¥ ì²˜ë¦¬]
    end
    
    I --> AM[ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ]
    AI --> AM
    AJ --> AM
    AK --> AM
    AL --> AM
    P --> AM
    Q --> AM
    U --> AM
    AA --> AM
    AH --> AM
```

## Enhanced Usage-based Recommendation Engine

ì‚¬ìš©ìì˜ ì‹¤ì œ ë°ì´í„°/ìŒì„±/SMS ì‚¬ìš© íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ **6ê°€ì§€ ì‚¬ìš©ì íƒ€ì…**ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³ ,
**êµ¬ì²´ì ì¸ ì ˆì•½/ì´ë“ ê¸ˆì•¡**ê³¼ í•¨ê»˜ ë§ì¶¤í˜• ìš”ê¸ˆì œë¥¼ ì¶”ì²œí•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### **AI ê¸°ë°˜ ì‚¬ìš©ì íƒ€ì… ë¶„ì„**

```mermaid
graph LR
    A[ì‚¬ìš©ëŸ‰ ë°ì´í„°] --> B[ê°€ì¤‘í‰ê·  ê³„ì‚°]
    B --> C[íŒ¨í„´ ë¶„ì„]
    C --> D{ì‚¬ìš©ì íƒ€ì…}
    
    D --> E[í—¤ë¹„ ì‚¬ìš©ì<br/>85%+]
    D --> F[ì•ˆì • ì¶”êµ¬í˜•<br/>70-84%]
    D --> G[ê· í˜•ì¡íŒ<br/>40-69% >2GB]
    D --> H[ìŠ¤ë§ˆíŠ¸ ì„ íƒí˜•<br/>40-69% â‰¤2GB]
    D --> I[ì ˆì•½í˜•<br/>20-39%]
    D --> J[ë¼ì´íŠ¸<br/><20%]
```

### **êµ¬ì²´ì  ë¹„ìš© íš¨ê³¼ ë¶„ì„í•˜ì—¬ ì œê³µ**

| ì¶”ì²œ íƒ€ì… | ë¹„ìš© ë³€í™” | ì‹¤ìƒí™œ ë¹„êµ ì˜ˆì‹œ |
|-----------|-----------|------------------|
| **urgent_upgrade** | ì›” +15,000ì› | "ì¹˜í‚¨ 2ë²ˆ ê°’ìœ¼ë¡œ ë°ì´í„° ê±±ì • ì œë¡œ!" |
| **upgrade** | ì›” +8,000ì› | "ì¹´í˜ ì•„ë©”ë¦¬ì¹´ë…¸ 8ì” ê°’ìœ¼ë¡œ ì—¬ìœ  í™•ë³´!" |
| **maintain** | ë™ì¼ ê°€ê²© | "ê°™ì€ ê°€ê²©ì— ë” ë§ì€ í˜œíƒ!" |
| **downgrade** | ì›” -12,000ì› | "ì—°ê°„ 144,000ì› ì ˆì•½ = ë„·í”Œë¦­ìŠ¤ 1ë…„!" |
| **cost_optimize** | ì›” -8,000ì› | "ì ˆì•½í•œ ëˆìœ¼ë¡œ ìœ íŠœë¸Œ í”„ë¦¬ë¯¸ì—„ê¹Œì§€!" |

### **ìŠ¤ë§ˆíŠ¸ í•„í„°ë§ ë¡œì§**

```mermaid
flowchart TD
    A[ì‚¬ìš©ë¥  ë¶„ì„] --> B{95%+}
    A --> C{85-94%}
    A --> D{70-84%}
    A --> E{40-69%}
    A --> F{20-39%}
    A --> G{<20%}
    
    B --> H[urgent_upgrade<br/>ìƒìœ„ ìš”ê¸ˆì œ 3ê°œ]
    C --> I[upgrade<br/>+2ë§Œì› ì´ë‚´ 2ê°œ]
    D --> J[maintain<br/>Â±1ë§Œì› ì´ë‚´ 2ê°œ]
    E --> K[alternative<br/>Â±1.5ë§Œì› ì´ë‚´ 3ê°œ]
    F --> L[cost_optimize<br/>í˜„ì¬ê°€ ì´í•˜ 3ê°œ]
    G --> M[downgrade<br/>í•˜ìœ„ ìš”ê¸ˆì œ 3ê°œ]
```

## Redis ì„¸ì…˜ ê´€ë¦¬

### **í†µí•©ëœ ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´**

```mermaid
stateDiagram-v2
    [*] --> ì…ë ¥_ê²€ì¦
    ì…ë ¥_ê²€ì¦ --> AI_ì¸í…íŠ¸_ë¶„ë¥˜: Valid Input
    ì…ë ¥_ê²€ì¦ --> Nonsense_ì²˜ë¦¬: Invalid Input
    
    AI_ì¸í…íŠ¸_ë¶„ë¥˜ --> í´ë°±_ë¡œì§_ê²€ì¦
    í´ë°±_ë¡œì§_ê²€ì¦ --> ì¦‰ì‹œ_ë¶„ë¥˜: í™•ì‹¤í•œ ì¼€ì´ìŠ¤
    í´ë°±_ë¡œì§_ê²€ì¦ --> GPT_AI_ë¶„ë¥˜: ì• ë§¤í•œ ì¼€ì´ìŠ¤
    
    ì¦‰ì‹œ_ë¶„ë¥˜ --> ì¸í…íŠ¸_ë¼ìš°íŒ…
    GPT_AI_ë¶„ë¥˜ --> ì¸í…íŠ¸_ë¼ìš°íŒ…
    Nonsense_ì²˜ë¦¬ --> ì¸í…íŠ¸_ë¼ìš°íŒ…
    
    ì¸í…íŠ¸_ë¼ìš°íŒ… --> ë©€í‹°í„´_ì‹œì‘: telecom_plan/subscription
    ì¸í…íŠ¸_ë¼ìš°íŒ… --> ì§ì ‘_ì‘ë‹µ: ê¸°íƒ€ ì¸í…íŠ¸
    
    ë©€í‹°í„´_ì‹œì‘ --> ì„¸ì…˜_í‚¤_í†µì¼
    ì„¸ì…˜_í‚¤_í†µì¼ --> 1ë‹¨ê³„_ì§ˆë¬¸
    1ë‹¨ê³„_ì§ˆë¬¸ --> 2ë‹¨ê³„_ì§ˆë¬¸: multiturn_answer
    2ë‹¨ê³„_ì§ˆë¬¸ --> 3ë‹¨ê³„_ì§ˆë¬¸: multiturn_answer
    3ë‹¨ê³„_ì§ˆë¬¸ --> 4ë‹¨ê³„_ì§ˆë¬¸: multiturn_answer
    4ë‹¨ê³„_ì§ˆë¬¸ --> ìµœì¢…_ì¶”ì²œ: multiturn_answer
    
    ìµœì¢…_ì¶”ì²œ --> ì„¸ì…˜_ì™„ì „_ì´ˆê¸°í™”
    ì§ì ‘_ì‘ë‹µ --> ì„¸ì…˜_ì™„ì „_ì´ˆê¸°í™”
    ì„¸ì…˜_ì™„ì „_ì´ˆê¸°í™” --> [*]
    
    note right of AI_ì¸í…íŠ¸_ë¶„ë¥˜
        GPT-4o-mini + í´ë°± ë¡œì§
        99% ì •í™•ë„ ë‹¬ì„±
    end note
    
    note right of ì„¸ì…˜_í‚¤_í†µì¼
        phone_plan_flow_step
        subscription_flow_step
        user_info í†µí•© ê´€ë¦¬
    end note
    
    note right of ë©€í‹°í„´_ì‹œì‘
        Redis TTL: 30ë¶„
        ì—ëŸ¬ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜
        ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜
    end note
```

## API ì—”ë“œí¬ì¸íŠ¸

### **ğŸ“ ì±„íŒ… ê´€ë ¨**
- `POST /api/chat` - ì¼ë°˜ ì±„íŒ… ë° ë©€í‹°í„´ ì¶”ì²œ
- `POST /api/chat/likes` - ì¢‹ì•„ìš” ê¸°ë°˜ êµ¬ë… ì¶”ì²œ

### **ğŸ“Š ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ì¶”ì²œ**
- `POST /api/chat/usage/recommend` - ì‚¬ìš©ëŸ‰ ë¶„ì„ ë° ìš”ê¸ˆì œ ì¶”ì²œ
- `GET /api/chat/usage/{user_id}` - ì‚¬ìš©ì ì‚¬ìš©ëŸ‰ ì¡°íšŒ

### **ğŸ¯ UBTI ì„±í–¥ ë¶„ì„**
- `POST /api/ubti/question` - UBTI ì§ˆë¬¸ ìŠ¤íŠ¸ë¦¬ë°
- `POST /api/ubti/result` - UBTI ìµœì¢… ê²°ê³¼ ë° ì¶”ì²œ

### **ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬**
- `GET /api/users/{user_id}` - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- `GET /api/users/` - ì „ì²´ ì‚¬ìš©ì ëª©ë¡

### **ğŸ”§ ì‹œìŠ¤í…œ ìƒíƒœ**
- `GET /health` - ì„œë²„ ìƒíƒœ í™•ì¸
- `GET /api/status` - ì„œë¹„ìŠ¤ë³„ ìƒíƒœ ì •ë³´

## í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸

```bash
# ì„œë²„ ìƒíƒœ í™•ì¸
curl http://localhost:8000/health

# AI ì‹œìŠ¤í…œ ìƒíƒœ
curl http://localhost:8000/api/status

# ì¸í…íŠ¸ ë¶„ë¥˜ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8000/debug/intent \
  -H "Content-Type: application/json" \
  -d '{"message": "ìš”ê¸ˆì œ ì¶”ì²œí•´ì¤˜"}'
```

## ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

- **Intent Classification Accuracy**: ì‹¤ì‹œê°„ ì¸í…íŠ¸ ë¶„ë¥˜ ì •í™•ë„
- **Session Management**: í™œì„± ì„¸ì…˜ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- **Response Time**: API ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
- **Error Rate**: ì˜¤ë¥˜ ë°œìƒë¥  ë° ë³µêµ¬ìœ¨